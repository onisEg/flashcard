<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flashcard - نظام الحفظ الذكي</title>

    <!-- استيراد خط Cairo من Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- مكتبات خارجية -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ===== المتغيرات العامة ===== */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --text-color: #333;
            --bg-color: #f5f7fa;
            --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --border-radius: 10px;
            --font-size-base: 14px;
        }

        /* ===== الإعدادات الأساسية ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            direction: rtl;
            min-height: 100vh;
            line-height: 1.5;
            font-weight: 400;
            font-size: var(--font-size-base);
        }

        h1,
        h2,
        h3 {
            font-weight: 700;
        }

        /* ===== حاوية التطبيق ===== */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* ===== شريط التنقل ===== */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .nav-brand i {
            margin-left: 0.5rem;
            font-size: 1.8rem;
        }

        .nav-menu {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: none;
            border: none;
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* ===== المحتوى الرئيسي ===== */
        .main-content {
            flex: 1;
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .section-header h1 {
            font-size: 2rem;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .section-header p {
            color: #7f8c8d;
            font-size: 1rem;
            font-weight: 500;
        }

        .words-counter {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            display: inline-block;
            margin-bottom: 1.5rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .words-counter i {
            margin-left: 0.5rem;
        }

        /* ===== قسم الرفع ===== */
        .upload-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            transition: var(--transition);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .upload-section:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0 auto;
            display: block;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }

        .upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.02), rgba(46, 204, 113, 0.02));
            margin-top: 1rem;
            display: none;
        }

        .upload-area.active {
            display: block;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.05), rgba(46, 204, 113, 0.05));
            transform: translateY(-2px);
        }

        .upload-area i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        .upload-area h3 {
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .file-info {
            color: #7f8c8d;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        /* ===== إدارة الكلمات ===== */
        .word-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .word-management h3 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
            text-align: center;
        }

        .add-word-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .add-word-form input {
            flex: 1;
            min-width: 200px;
            padding: 0.6rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .add-word-form input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .word-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 1rem;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
            transition: var(--transition);
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .word-content {
            flex: 1;
        }

        .word-text {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.2rem;
        }

        .word-translation {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .word-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn,
        .delete-btn {
            background: none;
            border: none;
            padding: 0.4rem 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .edit-btn {
            color: var(--primary-color);
        }

        .edit-btn:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .delete-btn {
            color: var(--danger-color);
        }

        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.1);
        }

        /* ===== عناصر التحكم ===== */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-box i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
            font-size: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.6rem 2.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            font-size: 0.9rem;
            transition: var(--transition);
            background: #f8f9fa;
            font-weight: 500;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .filter-options {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-options select,
        .filter-options button {
            padding: 0.6rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-options select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .filter-options button {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .filter-options button:hover {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* ===== شبكة الفلاش كاردز ===== */
        .flashcards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .flashcard {
            height: 110px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
            margin-bottom: 40px;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 0.8rem;
            text-align: center;
            transition: var(--transition);
        }

        .flashcard-front {
            background: linear-gradient(135deg, var(--primary-color), #5dade2);
            color: white;
        }

        .flashcard-back {
            background: linear-gradient(135deg, var(--secondary-color), #58d68d);
            color: white;
            transform: rotateY(180deg);
        }

        .flashcard h3 {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            word-break: break-word;
        }

        /* ===== أنماط مستوى الحفظ ===== */
        .storage-indicator {
            position: absolute;
            top: 5px;
            left: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            font-size: 0.8rem;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 50%;
            width: 24px;
            height: 24px;
        }

        .storage-indicator i {
            font-size: 0.9rem;
        }

        .storage-controls {
            position: absolute;
            bottom: -35px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .flashcard:hover .storage-controls {
            opacity: 1;
        }

        .storage-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .storage-btn.weak {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .storage-btn.medium {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: white;
        }

        .storage-btn.strong {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .storage-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* ===== قسم الاختبار ===== */
        .quiz-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-setup {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .quiz-setup h3 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .quiz-setup-options {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .quiz-setup-options label {
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        .quiz-setup-options select {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .quiz-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
        }

        .stat-item {
            text-align: center;
        }

        .stat-item span:first-child {
            display: block;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .stat-item span:last-child {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .quiz-timer {
            text-align: center;
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--warning-color);
        }

        .quiz-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .quiz-question {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .quiz-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.05);
            transform: translateY(-2px);
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .quiz-option:hover::before {
            left: 100%;
        }

        .quiz-option.correct {
            background: linear-gradient(135deg, var(--secondary-color), #27ae60);
            color: white;
            border-color: var(--secondary-color);
            animation: pulse 0.5s;
        }

        .quiz-option.incorrect {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
            border-color: var(--danger-color);
            animation: shake 0.5s;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .quiz-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ===== الأزرار ===== */
        .primary-btn,
        .secondary-btn,
        .danger-btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }

        .secondary-btn {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .secondary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(149, 165, 166, 0.4);
        }

        .danger-btn {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }

        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.4);
        }

        .hidden {
            display: none !important;
        }

        /* ===== قسم الإحصائيات ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            background: rgba(52, 152, 219, 0.1);
            width: 80px;
            height: 80px;
            line-height: 80px;
            border-radius: 50%;
            display: inline-block;
        }

        .stat-card h3 {
            color: #7f8c8d;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .stat-card span {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .progress-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }

        .progress-section h3 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .progress-bar {
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 1rem 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(45deg,
                    rgba(255, 255, 255, 0.2) 25%,
                    transparent 25%,
                    transparent 50%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.2) 75%,
                    transparent 75%,
                    transparent);
            background-size: 30px 30px;
            animation: move 2s linear infinite;
        }

        @keyframes move {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 30px 30px;
            }
        }

        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            height: 400px;
        }

        /* ===== قسم الإعدادات ===== */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .setting-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .setting-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .setting-card h3 {
            color: var(--dark-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .setting-card h3 i {
            color: var(--primary-color);
        }

        .setting-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.7rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-option:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .setting-option label {
            color: #555;
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* ===== زر التبديل ===== */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked+.slider {
            background-color: var(--primary-color);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* ===== النافذة المنبثقة ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close:hover {
            color: var(--danger-color);
            background: rgba(231, 76, 60, 0.1);
        }

        .result-details {
            margin: 1.5rem 0;
            text-align: right;
        }

        .result-details p {
            margin-bottom: 0.7rem;
            font-size: 1rem;
            color: #555;
            font-weight: 500;
        }

        .result-details span {
            font-weight: 600;
            color: var(--dark-color);
        }

        /* ===== نافذة تعديل الكلمة ===== */
        .edit-modal .modal-content {
            max-width: 600px;
        }

        .edit-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .edit-form input {
            padding: 0.8rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .edit-form input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .edit-form-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* ===== التصميم المتجاوب ===== */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-menu {
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .section-header h1 {
                font-size: 1.8rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-options {
                justify-content: center;
                flex-wrap: wrap;
            }

            .flashcards-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.8rem;
            }

            .quiz-options {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 20% auto;
                width: 90%;
            }

            .quiz-setup-options {
                flex-direction: column;
                gap: 0.8rem;
            }

            .add-word-form {
                flex-direction: column;
            }

            .word-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .word-actions {
                align-self: flex-end;
            }

            /* ===== تحسينات أزرار التقييم للموبايل ===== */
            .storage-controls {
                opacity: 1 !important;
                /* إجبار الأزرار على الظهور */
                bottom: -38px;
                gap: 8px;
            }

            .flashcard {
                margin-bottom: 55px;
                /* زيادة المسافة أسفل الكرت */
            }

            .storage-btn {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .storage-btn:active {
                transform: scale(0.95);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }
        }

        /* ===== الوضع الليلي ===== */
        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --light-color: #2c3e50;
            --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .navbar {
            background: linear-gradient(135deg, #2c3e50, #34495e);
        }

        body.dark-mode .upload-section,
        body.dark-mode .flashcard-front,
        body.dark-mode .flashcard-back,
        body.dark-mode .quiz-container,
        body.dark-mode .stat-card,
        body.dark-mode .progress-section,
        body.dark-mode .chart-container,
        body.dark-mode .setting-card,
        body.dark-mode .modal-content,
        body.dark-mode .controls,
        body.dark-mode .quiz-setup,
        body.dark-mode .word-management {
            background: var(--light-color);
            color: var(--text-color);
        }

        body.dark-mode .upload-area {
            border-color: #7f8c8d;
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.05), rgba(46, 204, 113, 0.05));
        }

        body.dark-mode .search-box input,
        body.dark-mode .filter-options select {
            background: #34495e;
            color: var(--text-color);
            border-color: #7f8c8d;
        }

        body.dark-mode .quiz-card {
            background: #34495e;
        }

        body.dark-mode .quiz-option {
            background: var(--light-color);
            color: var(--text-color);
            border-color: #7f8c8d;
        }

        body.dark-mode .setting-option {
            border-bottom-color: #34495e;
        }

        body.dark-mode .section-header h1,
        body.dark-mode .section-header p,
        body.dark-mode .upload-area h3,
        body.dark-mode .setting-card h3 {
            color: var(--text-color);
        }

        body.dark-mode .words-counter {
            background: linear-gradient(135deg, #2980b9, #34495e);
        }

        body.dark-mode .word-list {
            border-color: #7f8c8d;
        }

        body.dark-mode .word-item {
            border-bottom-color: #34495e;
        }

        body.dark-mode .word-item:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        body.dark-mode .add-word-form input {
            background: #34495e;
            color: var(--text-color);
            border-color: #7f8c8d;
        }

        /* ===== الإشعارات ===== */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideDown 0.3s ease, fadeOut 0.3s ease 2.7s;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .notification.error {
            background: var(--danger-color);
        }

        .no-cards {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-top: 2rem;
            padding: 2rem;
            font-weight: 500;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* ===== تحسينات إضافية ===== */
        select,
        input[type="number"],
        input[type="range"] {
            font-family: 'Cairo', sans-serif;
            font-size: inherit;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 0.5rem;
        }

        button:focus,
        select:focus,
        input:focus {
            outline: none;
        }

        /* ===== تأثيرات الحركة ===== */
        .hover-lift {
            transition: var(--transition);
        }

        .hover-lift:hover {
            transform: translateY(-3px);
        }

        /* ===== تحسينات الطباعة ===== */
        @media print {

            .navbar,
            .controls,
            .upload-section,
            .words-counter,
            .word-management {
                display: none;
            }

            .flashcard {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            .flashcard-inner {
                transform: none !important;
            }

            .flashcard-back {
                display: none;
            }
        }

        /* ===== تحسينات للموبايل ===== */
        @media (max-width: 768px) {

            /* تحسين تجربة اللمس على الكروت */
            .flashcard {
                height: 130px;
            }

            .flashcard-inner {
                transition: transform 0.4s ease;
            }

            /* زيادة مساحة النقر على الكروت */
            .flashcard-front,
            .flashcard-back {
                padding: 1rem;
            }

            /* تحسين حجم الخط على الموبايل */
            .flashcard h3 {
                font-size: 1rem;
            }
        }

        /* ===== تحسينات للشاشات الصغيرة جداً ===== */
        @media (max-width: 480px) {
            .flashcards-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.5rem;
            }

            .flashcard {
                height: 120px;
                margin-bottom: 50px;
            }

            .flashcard h3 {
                font-size: 0.9rem;
            }

            .storage-controls {
                opacity: 1 !important;
                /* إجبار الأزرار على الظهور */
                bottom: -35px;
                gap: 6px;
            }

            .storage-btn {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }

            .storage-btn:active {
                transform: scale(0.95);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- شريط التنقل -->
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>flashcard</span>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-section="home">
                    <i class="fas fa-home"></i> الرئيسية
                </button>
                <button class="nav-btn" data-section="quiz">
                    <i class="fas fa-question-circle"></i> اختبار
                </button>
                <button class="nav-btn" data-section="stats">
                    <i class="fas fa-chart-bar"></i> إحصائيات
                </button>
                <button class="nav-btn" data-section="settings">
                    <i class="fas fa-cog"></i> إعدادات
                </button>
            </div>
        </nav>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- قسم الرئيسية -->
            <section id="home" class="content-section active">
                <div class="section-header">
                    <h1>مكتبة flashcard</h1>
                    <p>تعلم التعبيرات الإسبانية بسهولة وفعالية</p>
                </div>

                <div style="text-align: center;">
                    <div class="words-counter" id="wordsCounter">
                        <i class="fas fa-layer-group"></i>
                        <span id="totalWordsCount">0</span> تعبير
                    </div>
                </div>

                <div class="controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="بحث في التعبيرات...">
                    </div>
                    <div class="filter-options">
                        <select id="storageLevelFilter">
                            <option value="all">كل المستويات</option>
                            <option value="weak">مستوى 1</option>
                            <option value="medium">مستوى 2</option>
                            <option value="strong">مستوى 3</option>
                        </select>
                        <button id="shuffleBtn">
                            <i class="fas fa-random"></i> عشوائي
                        </button>
                        <button id="resetBtn">
                            <i class="fas fa-sync-alt"></i> تحديث
                        </button>
                    </div>
                </div>

                <div id="flashcards-container" class="flashcards-grid"></div>
            </section>

            <!-- قسم الاختبار -->
            <section id="quiz" class="content-section">
                <div class="section-header">
                    <h1>وضعية الاختبار</h1>
                    <p>اختبر معرفتك بالتعبيرات الإسبانية</p>
                </div>

                <div class="quiz-container">
                    <!-- إعدادات الاختبار -->
                    <div class="quiz-setup" id="quizSetup">
                        <h3>إعدادات الاختبار</h3>
                        <div class="quiz-setup-options">
                            <label>عدد التعبيرات:</label>
                            <select id="quizWordCount">
                                <option value="5">5 تعبيرات</option>
                                <option value="10" selected>10 تعبيرات</option>
                                <option value="15">15 تعبيراً</option>
                                <option value="20">20 تعبيراً</option>
                                <option value="all">كل التعبيرات</option>
                            </select>
                            <label>مدة كل سؤال:</label>
                            <select id="quizTimer">
                                <option value="5" selected>5 ثواني</option>
                                <option value="10">10 ثواني</option>
                                <option value="15">15 ثانية</option>
                                <option value="30">30 ثانية</option>
                                <option value="0">بدون مؤقت</option>
                            </select>
                        </div>
                        <button id="startQuizBtn" class="primary-btn" style="margin-top: 1rem;">بدء الاختبار</button>
                    </div>

                    <!-- واجهة الاختبار -->
                    <div id="quizInterface" class="hidden">
                        <div class="quiz-stats">
                            <div class="stat-item">
                                <span>السؤال</span>
                                <span id="currentQuestion">1/10</span>
                            </div>
                            <div class="stat-item">
                                <span>النتيجة</span>
                                <span id="quizScore">0</span>
                            </div>
                            <div class="stat-item">
                                <span>الوقت المتبقي</span>
                                <span id="timeRemaining">5</span>
                            </div>
                        </div>

                        <div class="quiz-timer" id="quizTimerDisplay">
                            <!-- سيتم عرض المؤقت هنا -->
                        </div>

                        <div class="quiz-card">
                            <div class="quiz-question" id="quizQuestion">
                                <!-- سيتم عرض السؤال هنا -->
                            </div>
                            <div class="quiz-options" id="quizOptions">
                                <!-- سيتم عرض الخيارات هنا -->
                            </div>
                        </div>

                        <div class="quiz-controls">
                            <button id="nextQuestionBtn" class="primary-btn hidden">السؤال التالي</button>
                            <button id="finishQuizBtn" class="secondary-btn hidden">إنهاء الاختبار</button>
                            <button id="cancelQuizBtn" class="danger-btn">إلغاء الاختبار</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- قسم الإحصائيات -->
            <section id="stats" class="content-section">
                <div class="section-header">
                    <h1>إحصائيات التقدم</h1>
                    <p>تتبع أدائك وتقدمك في التعلم</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-book"></i>
                        <h3>إجمالي التعبيرات</h3>
                        <span id="totalWords">0</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3>تعبيرات مستوى 3</h3>
                        <span id="strongWords">0</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star-half-alt"></i>
                        <h3>تعبيرات مستوى 2</h3>
                        <span id="mediumWords">0</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-times-circle"></i>
                        <h3>تعبيرات مستوى 1</h3>
                        <span id="weakWords">0</span>
                    </div>
                </div>

                <div class="progress-section">
                    <h3>تقدمك اليوم</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="dailyProgress"></div>
                    </div>
                    <p>هدف اليوم: <span id="dailyGoal">20</span> تعبيراً</p>
                </div>

                <div class="chart-container">
                    <canvas id="progressChart"></canvas>
                </div>
            </section>

            <!-- قسم الإعدادات -->
            <section id="settings" class="content-section">
                <div class="section-header">
                    <h1>الإعدادات</h1>
                    <p>تخصيص تجربة التعلم الخاصة بك</p>
                </div>

                <!-- قسم إدارة الكلمات -->
                <div class="word-management">
                    <h3><i class="fas fa-edit"></i> إدارة التعبيرات</h3>
                    <div class="add-word-form">
                        <input type="text" id="newWord" placeholder="التعبير الإسباني">
                        <input type="text" id="newTranslation" placeholder="الترجمة العربية">
                        <button class="primary-btn" onclick="addWord()">
                            <i class="fas fa-plus"></i> إضافة تعبير
                        </button>
                    </div>
                    <div class="word-list" id="wordList"></div>
                </div>

                <div class="upload-section">
                    <button class="upload-btn" id="uploadBtn">
                        <i class="fas fa-upload"></i> رفع ملف
                    </button>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>اسحب وأفلت الملف هنا أو</h3>
                        <input type="file" id="csvFile" accept=".csv,.xlsx,.xls">
                        <button class="upload-btn" onclick="document.getElementById('csvFile').click()">
                            اختر ملف
                        </button>
                        <p class="file-info">يدعم ملفات CSV و Excel (صيغة: تعبير,ترجمة)</p>
                    </div>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <h3><i class="fas fa-palette"></i> المظهر</h3>
                        <div class="setting-option">
                            <label>الوضع الليلي</label>
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-option">
                            <label>لغة الواجهة</label>
                            <select id="languageSelect">
                                <option value="ar">العربية</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-card">
                        <h3><i class="fas fa-volume-up"></i> الصوت</h3>
                        <div class="setting-option">
                            <label>تأثيرات الصوت</label>
                            <label class="switch">
                                <input type="checkbox" id="soundToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-option">
                            <label>مستوى الصوت</label>
                            <input type="range" id="volumeSlider" min="0" max="100" value="50">
                        </div>
                    </div>

                    <div class="setting-card">
                        <h3><i class="fas fa-brain"></i> خيارات التعلم</h3>
                        <div class="setting-option">
                            <label>عدد التعبيرات اليومية</label>
                            <input type="number" id="dailyWordsGoal" value="20" min="5" max="100">
                        </div>
                        <div class="setting-option">
                            <label>وضع المراجعة الذكية</label>
                            <label class="switch">
                                <input type="checkbox" id="smartReviewToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <h3><i class="fas fa-database"></i> إدارة البيانات</h3>
                        <button class="secondary-btn" id="exportDataBtn">
                            <i class="fas fa-download"></i> تصدير البيانات
                        </button>
                        <button class="danger-btn" id="clearDataBtn">
                            <i class="fas fa-trash"></i> مسح البيانات
                        </button>
                        <div style="margin-top: 1rem;">
                            <button class="primary-btn" id="resetToDefaultBtn">
                                <i class="fas fa-sync-alt"></i> استعادة التعبيرات الافتراضية
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- نافذة منبثقة للنتائج -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>نتيجة الاختبار</h2>
            <div class="result-details">
                <p>إجمالي الأسئلة: <span id="totalQuestions"></span></p>
                <p>الإجابات الصحيحة: <span id="correctAnswers"></span></p>
                <p>النسبة المئوية: <span id="percentageScore"></span></p>
            </div>
            <button class="primary-btn" id="closeModalBtn">موافق</button>
        </div>
    </div>

    <!-- نافذة تعديل الكلمة -->
    <div id="editModal" class="modal edit-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>تعديل التعبير</h2>
            <div class="edit-form">
                <input type="text" id="editWord" placeholder="التعبير الإسباني">
                <input type="text" id="editTranslation" placeholder="الترجمة العربية">
                <div class="edit-form-buttons">
                    <button class="primary-btn" onclick="saveEditWord()">حفظ</button>
                    <button class="secondary-btn" onclick="closeEditModal()">إلغاء</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== المتغيرات العامة =====
        let flashcards = [];
        let filteredCards = [];
        let currentQuiz = null;
        let studyStartTime = null;
        let studyStats = {
            totalWords: 0,
            masteredWords: 0,
            studyTime: 0,
            dailyProgress: 0
        };
        let quizTimer = null;
        let timeRemaining = 5;
        let answerSelected = false;
        let editingCardId = null;

        // ===== إصدار التطبيق =====
        const APP_VERSION = '2.1'; // قم بتغيير هذا الرقم عند تحديث التعبيرات الافتراضية

        // ===== الكلمات الافتراضية - تعبيرات إسبانية-عربية =====
        const defaultWords = [
            { word: "Hola", translation: "مرحبا", storageLevel: 'weak' },
            { word: "Buenos días", translation: "صباح الخير", storageLevel: 'weak' },
            { word: "Buenas tardes", translation: "مساء الخير", storageLevel: 'medium' },
            { word: "Buenas noches", translation: "طاب مساؤك", storageLevel: 'medium' },
            { word: "Por favor", translation: "من فضلك", storageLevel: 'strong' },
            { word: "Gracias", translation: "شكرا", storageLevel: 'strong' },
            { word: "De nada", translation: "على الرحب والسعة", storageLevel: 'strong' },
            { word: "Lo siento", translation: "آسف", storageLevel: 'medium' },
            { word: "¿Cómo estás?", translation: "كيف حالك؟", storageLevel: 'medium' },
            { word: "Estoy bien", translation: "أنا بخير", storageLevel: 'medium' },
            { word: "¿Y tú?", translation: "وأنتم؟", storageLevel: 'weak' },
            { word: "Mucho gusto", translation: "تشرفت بلقائك", storageLevel: 'strong' },
            { word: "Hasta luego", translation: "إلى اللقاء", storageLevel: 'medium' },
            { word: "Adiós", translation: "وداعا", storageLevel: 'strong' },
            { word: "Te quiero", translation: "أحبك", storageLevel: 'strong' },
            { word: "Te amo", translation: "أنا أحبك", storageLevel: 'strong' },
            { word: "¿Qué tal?", translation: "ما أخبارك؟", storageLevel: 'medium' },
            { word: "No entiendo", translation: "لا أفهم", storageLevel: 'weak' },
            { word: "¿Hablas inglés?", translation: "هل تتحدث الإنجليزية؟", storageLevel: 'medium' },
            { word: "¿Dónde está el baño?", translation: "أين الحمام؟", storageLevel: 'weak' },
            { word: "¿Cuánto cuesta?", translation: "كم الثمن؟", storageLevel: 'medium' },
            { word: "Me gusta", translation: "أنا أحب", storageLevel: 'strong' },
            { word: "No me gusta", translation: "لا أحب", storageLevel: 'medium' },
            { word: "Encantado", translation: "تشرفت", storageLevel: 'strong' },
            { word: "Feliz cumpleaños", translation: "عيد ميلاد سعيد", storageLevel: 'medium' },
            { word: "Buen provecho", translation: "بالهناء والشفاء", storageLevel: 'weak' },
            { word: "Salud", translation: "صحة", storageLevel: 'weak' },
            { word: "¡Qué bueno!", translation: "ماذا أروع!", storageLevel: 'medium' },
            { word: "¡Qué lástima!", translation: "للأسف!", storageLevel: 'medium' },
            { word: "No hay problema", translation: "لا توجد مشكلة", storageLevel: 'strong' },
            { word: "Claro que sí", translation: "بالتأكيد", storageLevel: 'strong' },
            { word: "¡Vamos!", translation: "هيا بنا!", storageLevel: 'medium' },
            { word: "¡Ayuda!", translation: "ساعد!", storageLevel: 'weak' },
            { word: "Cuidado", translation: "انتبه", storageLevel: 'weak' },
            { word: "Tranquilo", translation: "هادئ", storageLevel: 'medium' },
            { word: "Rápido", translation: "سريع", storageLevel: 'medium' },
            { word: "Despacio", translation: "ببطء", storageLevel: 'medium' },
            { word: "Ahora", translation: "الآن", storageLevel: 'strong' },
            { word: "Después", translation: "بعد ذلك", storageLevel: 'medium' },
            { word: "Siempre", translation: "دائما", storageLevel: 'strong' },
            { word: "Nunca", translation: "أبدا", storageLevel: 'medium' },
            { word: "A veces", translation: "أحيانا", storageLevel: 'medium' },
            { word: "Hoy", translation: "اليوم", storageLevel: 'strong' },
            { word: "Mañana", translation: "غدا", storageLevel: 'strong' },
            { word: "Ayer", translation: "أمس", storageLevel: 'medium' },
            { word: "La semana pasada", translation: "الأسبوع الماضي", storageLevel: 'weak' },
            { word: "El mes próximo", translation: "الشهر القادم", storageLevel: 'weak' },
            { word: "El año pasado", translation: "العام الماضي", storageLevel: 'medium' },
            { word: "¿Qué hora es?", translation: "كم الساعة؟", storageLevel: 'medium' },
            { word: "Es la una", translation: "الساعة الواحدة", storageLevel: 'weak' },
            { word: "Son las dos", translation: "الساعة الثانية", storageLevel: 'weak' },
            { word: "En punto", translation: "تماما", storageLevel: 'weak' },
            { word: "Y media", translation: "ونصف", storageLevel: 'medium' },
            { word: "Y cuarto", translation: "وربع", storageLevel: 'medium' },
            { word: "Menos cuarto", translation: "إلا ربع", storageLevel: 'weak' },
            { word: "De la mañana", translation: "صباحا", storageLevel: 'medium' },
            { word: "De la tarde", translation: "بعد الظهر", storageLevel: 'medium' },
            { word: "De la noche", translation: "ليلا", storageLevel: 'medium' },
            { word: "La medianoche", translation: "منتصف الليل", storageLevel: 'weak' },
            { word: "El mediodía", translation: "الظهر", storageLevel: 'weak' },
            { word: "La madrugada", translation: "الفجر", storageLevel: 'weak' },
            { word: "El amanecer", translation: "شروق الشمس", storageLevel: 'weak' },
            { word: "El atardecer", translation: "غروب الشمس", storageLevel: 'weak' },
            { word: "La noche", translation: "الليل", storageLevel: 'strong' },
            { word: "El día", translation: "اليوم", storageLevel: 'strong' },
            { word: "La semana", translation: "الأسبوع", storageLevel: 'medium' },
            { word: "El mes", translation: "الشهر", storageLevel: 'medium' },
            { word: "El año", translation: "العام", storageLevel: 'medium' },
            { word: "La estación", translation: "الفصل", storageLevel: 'weak' },
            { word: "La primavera", translation: "الربيع", storageLevel: 'weak' },
            { word: "El verano", translation: "الصيف", storageLevel: 'medium' },
            { word: "El otoño", translation: "الخريف", storageLevel: 'weak' },
            { word: "El invierno", translation: "الشتاء", storageLevel: 'medium' },
            { word: "El tiempo", translation: "الطقس", storageLevel: 'medium' },
            { word: "Hace sol", translation: "الشمس مشرقة", storageLevel: 'medium' },
            { word: "Hace frío", translation: "الجو بارد", storageLevel: 'medium' },
            { word: "Hace calor", translation: "الجو حار", storageLevel: 'medium' },
            { word: "Llueve", translation: "تمطر", storageLevel: 'weak' },
            { word: "Nieva", translation: "تثلج", storageLevel: 'weak' },
            { word: "Hay viento", translation: "هناك رياح", storageLevel: 'weak' },
            { word: "Está nublado", translation: "الجو غائم", storageLevel: 'weak' },
            { word: "El arco iris", translation: "قوس قزح", storageLevel: 'weak' },
            { word: "La tormenta", translation: "العاصفة", storageLevel: 'weak' },
            { word: "La familia", translation: "العائلة", storageLevel: 'strong' },
            { word: "Los padres", translation: "الوالدان", storageLevel: 'medium' },
            { word: "La madre", translation: "الأم", storageLevel: 'strong' },
            { word: "El padre", translation: "الأب", storageLevel: 'strong' },
            { word: "Los hijos", translation: "الأبناء", storageLevel: 'medium' },
            { word: "El hijo", translation: "الابن", storageLevel: 'medium' },
            { word: "La hija", translation: "الابنة", storageLevel: 'medium' },
            { word: "Los hermanos", translation: "الإخوة", storageLevel: 'medium' },
            { word: "El hermano", translation: "الأخ", storageLevel: 'medium' },
            { word: "La hermana", translation: "الأخت", storageLevel: 'medium' },
            { word: "Los abuelos", translation: "الأجداد", storageLevel: 'weak' },
            { word: "El abuelo", translation: "الجد", storageLevel: 'weak' },
            { word: "La abuela", translation: "الجدة", storageLevel: 'weak' },
            { word: "Los tíos", translation: "الأعمام/العمات", storageLevel: 'weak' },
            { word: "El tío", translation: "العم/الخال", storageLevel: 'weak' },
            { word: "La tía", translation: "العمة/الخالة", storageLevel: 'weak' },
            { word: "Los primos", translation: "أبناء العم/الخال", storageLevel: 'weak' },
            { word: "El primo", translation: "ابن العم/الخال", storageLevel: 'weak' },
            { word: "La prima", translation: "بنت العم/الخالة", storageLevel: 'weak' },
            { word: "El sobrino", translation: "ابن الأخ/الأخت", storageLevel: 'weak' },
            { word: "La sobrina", translation: "بنت الأخ/الأخت", storageLevel: 'weak' },
            { word: "El esposo", translation: "الزوج", storageLevel: 'medium' },
            { word: "La esposa", translation: "الزوجة", storageLevel: 'medium' },
            { word: "El novio", translation: "الخطيب", storageLevel: 'medium' },
            { word: "La novia", translation: "الخطيبة", storageLevel: 'medium' },
            { word: "El amigo", translation: "الصديق", storageLevel: 'strong' },
            { word: "La amiga", translation: "الصديقة", storageLevel: 'strong' },
            { word: "El compañero", translation: "الزميل", storageLevel: 'medium' },
            { word: "La compañera", translation: "الزميلة", storageLevel: 'medium' },
            { word: "El vecino", translation: "الجار", storageLevel: 'weak' },
            { word: "La vecina", translation: "الجارة", storageLevel: 'weak' },
            { word: "La casa", translation: "المنزل", storageLevel: 'strong' },
            { word: "El apartamento", translation: "الشقة", storageLevel: 'medium' },
            { word: "La habitación", translation: "الغرفة", storageLevel: 'medium' },
            { word: "El dormitorio", translation: "غرفة النوم", storageLevel: 'medium' },
            { word: "La cocina", translation: "المطبخ", storageLevel: 'medium' },
            { word: "El baño", translation: "الحمام", storageLevel: 'strong' },
            { word: "La sala de estar", translation: "غرفة المعيشة", storageLevel: 'medium' },
            { word: "El comedor", translation: "غرفة الطعام", storageLevel: 'weak' },
            { word: "El jardín", translation: "الحديقة", storageLevel: 'medium' },
            { word: "El garaje", translation: "المرآب", storageLevel: 'weak' },
            { word: "El ático", translation: "العلية", storageLevel: 'weak' },
            { word: "El sótano", translation: "القبو", storageLevel: 'weak' },
            { word: "La puerta", translation: "الباب", storageLevel: 'medium' },
            { word: "La ventana", translation: "النافذة", storageLevel: 'medium' },
            { word: "La pared", translation: "الحائط", storageLevel: 'weak' },
            { word: "El suelo", translation: "الأرضية", storageLevel: 'weak' },
            { word: "El techo", translation: "السقف", storageLevel: 'weak' },
            { word: "La escalera", translation: "السلالم", storageLevel: 'weak' },
            { word: "El ascensor", translation: "المصعد", storageLevel: 'weak' },
            { word: "La llave", translation: "المفتاح", storageLevel: 'medium' },
            { word: "La cama", translation: "السرير", storageLevel: 'medium' },
            { word: "La mesa", translation: "الطاولة", storageLevel: 'strong' },
            { word: "La silla", translation: "الكرسي", storageLevel: 'strong' },
            { word: "El sofá", translation: "الأريكة", storageLevel: 'medium' },
            { word: "La lámpara", translation: "المصباح", storageLevel: 'medium' },
            { word: "El televisor", translation: "التلفزيون", storageLevel: 'medium' },
            { word: "El ordenador", translation: "الحاسوب", storageLevel: 'medium' },
            { word: "El móvil", translation: "الهاتف المحمول", storageLevel: 'strong' },
            { word: "La nevera", translation: "الثلاجة", storageLevel: 'medium' },
            { word: "El horno", translation: "الفرن", storageLevel: 'weak' },
            { word: "El microondas", translation: "الميكروويف", storageLevel: 'weak' },
            { word: "La lavadora", translation: "غسالة الملابس", storageLevel: 'weak' },
            { word: "El lavavajillas", translation: "غسالة الأطباق", storageLevel: 'weak' }
        ];

        // ===== تهيئة التطبيق =====
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            loadSavedData();
            setupEventListeners();
            updateStats();
            updateWordsCounter();
            displayWordList();
        });

        // ===== وظائف التهيئة =====
        function initializeApp() {
            // تحميل الإعدادات من localStorage
            const settings = getSettings();

            // تطبيق الوضع الليلي
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').checked = true;
            }

            // تطبيق إعدادات الصوت
            if (settings.soundEnabled === false) {
                document.getElementById('soundToggle').checked = false;
            }

            // تطبيق هدف الكلمات اليومية
            if (settings.dailyGoal) {
                document.getElementById('dailyWordsGoal').value = settings.dailyGoal;
                document.getElementById('dailyGoal').textContent = settings.dailyGoal;
            }
        }

        function loadSavedData() {
            try {
                const savedVersion = localStorage.getItem('appVersion');
                const savedCards = localStorage.getItem('flashcards');
                const savedStats = localStorage.getItem('studyStats');
                const savedSettings = localStorage.getItem('flashcardSettings');
                const lastUpdate = localStorage.getItem('lastUpdate');

                // التحقق من وجود تحديث للتطبيق
                if (savedVersion !== APP_VERSION) {
                    // تم تحديث التطبيق، قم بإعادة تعيين البيانات
                    console.log('تم تحديث التطبيق، جاري تحميل التعبيرات الجديدة...');
                    flashcards = [...defaultWords];
                    studyStats = {
                        totalWords: 0,
                        masteredWords: 0,
                        studyTime: 0,
                        dailyProgress: 0
                    };

                    // حفظ الإصدار الجديد والبيانات
                    localStorage.setItem('appVersion', APP_VERSION);
                    localStorage.setItem('flashcards', JSON.stringify(flashcards));
                    localStorage.setItem('studyStats', JSON.stringify(studyStats));
                    localStorage.setItem('lastUpdate', new Date().toISOString());

                    showNotification('تم تحديث التطبيق وتحميل التعبيرات الإسبانية الجديدة');
                } else if (savedCards) {
                    // لا يوجد تحديث، قم بتحميل البيانات المحفوظة
                    flashcards = JSON.parse(savedCards);

                    // التحقق من الحاجة للتحديث التلقائي للكلمات المرفوعة
                    checkAndUpdateUploadedWords();
                } else {
                    // أول استخدام للتطبيق
                    flashcards = [...defaultWords];
                    localStorage.setItem('appVersion', APP_VERSION);
                    localStorage.setItem('flashcards', JSON.stringify(flashcards));
                    localStorage.setItem('lastUpdate', new Date().toISOString());
                    showNotification('تمت إضافة تعبيرات افتراضية للمساعدة في البدء');
                }

                if (savedStats && savedVersion === APP_VERSION) {
                    studyStats = JSON.parse(savedStats);
                }

                if (savedSettings) {
                    applySettings(JSON.parse(savedSettings));
                }

                filteredCards = [...flashcards];
                displayFlashcards();
                updateStatsDisplay();

            } catch (e) {
                console.error('Error loading data:', e);
                showNotification('حدث خطأ أثناء تحميل البيانات', 'error');
            }
        }

        // ===== وظيفة التحقق والتحديث التلقائي للكلمات المرفوعة =====
        function checkAndUpdateUploadedWords() {
            const lastUpdate = localStorage.getItem('lastUpdate');
            const now = new Date();
            const lastUpdateDate = lastUpdate ? new Date(lastUpdate) : null;

            // إذا لم يكن هناك تاريخ تحديث أو مر أكثر من يوم منذ آخر تحديث
            if (!lastUpdateDate || (now - lastUpdateDate) > (24 * 60 * 60 * 1000)) {
                // دمج الكلمات المرفوعة مع الكلمات الافتراضية
                const mergedWords = mergeWordsWithDefaults(flashcards);

                if (mergedWords.length > flashcards.length) {
                    flashcards = mergedWords;
                    localStorage.setItem('flashcards', JSON.stringify(flashcards));
                    localStorage.setItem('lastUpdate', now.toISOString());

                    showNotification(`تم تحديث التعبيرات تلقائياً. إجمالي التعبيرات: ${mergedWords.length}`);
                }
            }
        }

        // ===== وظيفة دمج الكلمات المرفوعة مع الكلمات الافتراضية =====
        function mergeWordsWithDefaults(currentWords) {
            const merged = [...currentWords];
            const defaultWordsSet = new Set(defaultWords.map(w => w.word.toLowerCase()));

            // إضافة الكلمات الافتراضية التي ليست موجودة
            defaultWords.forEach(defaultWord => {
                if (!defaultWordsSet.has(defaultWord.word.toLowerCase())) {
                    merged.push({
                        ...defaultWord,
                        id: Date.now() + Math.random() // إنشاء ID فريد
                    });
                }
            });

            return merged;
        }

        function applySettings(settings) {
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').checked = true;
            }

            if (settings.soundEnabled === false) {
                document.getElementById('soundToggle').checked = false;
            }

            if (settings.dailyGoal) {
                document.getElementById('dailyWordsGoal').value = settings.dailyGoal;
                document.getElementById('dailyGoal').textContent = settings.dailyGoal;
            }
        }

        function setupEventListeners() {
            // التنقل بين الأقسام
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const section = btn.dataset.section;
                    showSection(section);

                    // تحديث الزر النشط
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // زر رفع الملف
            document.getElementById('uploadBtn').addEventListener('click', () => {
                document.getElementById('uploadArea').classList.toggle('active');
            });

            // رفع الملف
            const csvFile = document.getElementById('csvFile');
            csvFile.addEventListener('change', handleFileUpload);

            // السحب والإفلات
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary-color)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#bdc3c7';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#bdc3c7';

                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // البحث والتصفية
            document.getElementById('searchInput').addEventListener('input', filterCards);
            document.getElementById('storageLevelFilter').addEventListener('change', filterCards);

            // أزرار التحكم
            document.getElementById('shuffleBtn').addEventListener('click', shuffleCards);
            document.getElementById('resetBtn').addEventListener('click', resetCards);

            // الاختبار
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            document.getElementById('nextQuestionBtn').addEventListener('click', nextQuestion);
            document.getElementById('finishQuizBtn').addEventListener('click', finishQuiz);
            document.getElementById('cancelQuizBtn').addEventListener('click', cancelQuiz);

            // الإعدادات
            document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);
            document.getElementById('soundToggle').addEventListener('change', toggleSound);
            document.getElementById('dailyWordsGoal').addEventListener('change', updateDailyGoal);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('clearDataBtn').addEventListener('click', clearData);

            // زر استعادة التعبيرات الافتراضية
            document.getElementById('resetToDefaultBtn').addEventListener('click', resetToDefault);

            // النوافذ المنبثقة
            document.querySelector('.close').addEventListener('click', closeModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);

            // النافذة المنبثقة للتعديل
            document.querySelectorAll('#editModal .close').forEach(closeBtn => {
                closeBtn.addEventListener('click', closeEditModal);
            });

            // بدء تتبع وقت الدراسة
            studyStartTime = Date.now();
            setInterval(updateStudyTime, 60000); // تحديث كل دقيقة
        }

        // ===== وظائف عرض الأقسام =====
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById(sectionName).classList.add('active');

            // تحديث الرسم البياني عند عرض الإحصائيات
            if (sectionName === 'stats') {
                updateChart();
            }
        }

        // ===== وظيفة تحديث عداد الكلمات =====
        function updateWordsCounter() {
            document.getElementById('totalWordsCount').textContent = filteredCards.length;
        }

        // ===== وظائف إدارة الكلمات =====
        function addWord() {
            const word = document.getElementById('newWord').value.trim();
            const translation = document.getElementById('newTranslation').value.trim();

            if (!word || !translation) {
                showNotification('يرجى إدخال التعبير والترجمة', 'error');
                return;
            }

            // التحقق من وجود الكلمة مسبقاً
            const existingCard = flashcards.find(card =>
                card.word.toLowerCase() === word.toLowerCase() &&
                card.translation.toLowerCase() === translation.toLowerCase()
            );

            if (existingCard) {
                showNotification('هذا التعبير موجود بالفعل', 'error');
                return;
            }

            const newCard = {
                id: Date.now(),
                word,
                translation,
                mastered: false,
                lastReviewed: null,
                storageLevel: 'weak',
                reviewCount: 0,
                correctAnswers: 0
            };

            flashcards.push(newCard);
            filteredCards = [...flashcards];

            // مسح الحقول
            document.getElementById('newWord').value = '';
            document.getElementById('newTranslation').value = '';

            saveData();
            displayFlashcards();
            displayWordList();
            updateStats();
            updateWordsCounter();
            showNotification('تمت إضافة التعبير بنجاح');
        }

        function displayWordList() {
            const wordList = document.getElementById('wordList');
            wordList.innerHTML = '';

            if (flashcards.length === 0) {
                wordList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 1rem;">لا توجد تعبيرات مضافة بعد</p>';
                return;
            }

            const fragment = document.createDocumentFragment();

            flashcards.forEach(card => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-content">
                        <div class="word-text">${card.word}</div>
                        <div class="word-translation">${card.translation}</div>
                        <small style="color: #7f8c8d; margin-right: 10px;">
                            <i class="${getStorageLevelIcon(card.storageLevel)}" style="color: ${getStorageLevelColor(card.storageLevel)}"></i>
                        </small>
                    </div>
                    <div class="word-actions">
                        <button class="edit-btn" onclick="editWord(${card.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" onclick="deleteWord(${card.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                fragment.appendChild(wordItem);
            });

            wordList.appendChild(fragment);
        }

        function getStorageLevelIcon(level) {
            switch (level) {
                case 'strong': return 'fas fa-trophy';
                case 'medium': return 'fas fa-medal';
                default: return 'fas fa-seedling';
            }
        }

        function getStorageLevelColor(level) {
            switch (level) {
                case 'strong': return '#27ae60';
                case 'medium': return '#f39c12';
                default: return '#e74c3c';
            }
        }

        function getStorageLevelText(level) {
            switch (level) {
                case 'strong': return 'مستوى 3';
                case 'medium': return 'مستوى 2';
                default: return 'مستوى 1';
            }
        }

        function editWord(cardId) {
            const card = flashcards.find(c => c.id === cardId);
            if (!card) return;

            editingCardId = cardId;
            document.getElementById('editWord').value = card.word;
            document.getElementById('editTranslation').value = card.translation;

            document.getElementById('editModal').style.display = 'block';
        }

        function saveEditWord() {
            if (!editingCardId) return;

            const word = document.getElementById('editWord').value.trim();
            const translation = document.getElementById('editTranslation').value.trim();

            if (!word || !translation) {
                showNotification('يرجى إدخال التعبير والترجمة', 'error');
                return;
            }

            const cardIndex = flashcards.findIndex(c => c.id === editingCardId);
            if (cardIndex !== -1) {
                flashcards[cardIndex] = {
                    ...flashcards[cardIndex],
                    word,
                    translation
                };

                filteredCards = [...flashcards];
                saveData();
                displayFlashcards();
                displayWordList();
                updateStats();
                showNotification('تم تعديل التعبير بنجاح');
            }

            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingCardId = null;
        }

        function deleteWord(cardId) {
            if (confirm('هل أنت متأكد من حذف هذا التعبير؟')) {
                flashcards = flashcards.filter(card => card.id !== cardId);
                filteredCards = [...flashcards];

                saveData();
                displayFlashcards();
                displayWordList();
                updateStats();
                updateWordsCounter();
                showNotification('تم حذف التعبير بنجاح');
            }
        }

        // ===== وظيفة استعادة التعبيرات الافتراضية =====
        function resetToDefault() {
            if (confirm('هل أنت متأكد من استعادة التعبيرات الافتراضية؟ سيتم فقدان جميع التعبيرات المضافة يدوياً.')) {
                flashcards = [...defaultWords];
                filteredCards = [...flashcards];

                // تحديث الإصدار لمنع التحديث التلقائي مرة أخرى
                localStorage.setItem('appVersion', APP_VERSION);
                localStorage.setItem('lastUpdate', new Date().toISOString());

                saveData();
                displayFlashcards();
                displayWordList();
                updateStats();
                updateWordsCounter();
                showNotification('تم استعادة التعبيرات الافتراضية بنجاح');
            }
        }

        // ===== وظائف معالجة الملفات =====
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            const reader = new FileReader();

            if (file.name.endsWith('.csv')) {
                reader.onload = (e) => {
                    const text = e.target.result;
                    parseCSV(text);
                };
                reader.readAsText(file);
            } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                reader.onload = (e) => {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    parseExcelData(jsonData);
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const newCards = [];

            // تخطي السطر الأول إذا كان يحتوي على عناوين
            const startIndex = lines[0].includes('word') || lines[0].includes('كلمة') || lines[0].includes('تعبير') ? 1 : 0;

            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        const word = parts[0].trim();
                        const translation = parts[1].trim();

                        if (word && translation) {
                            newCards.push({
                                id: Date.now() + i,
                                word,
                                translation,
                                mastered: false,
                                lastReviewed: null,
                                storageLevel: 'weak',
                                reviewCount: 0,
                                correctAnswers: 0
                            });
                        }
                    }
                }
            }

            if (newCards.length > 0) {
                // دمج الكلمات المرفوعة مع الكلمات الحالية
                const mergedWords = mergeWordsWithDefaults([...flashcards, ...newCards]);
                flashcards = mergedWords;
                filteredCards = [...flashcards];

                // تحديث تاريخ آخر تحديث
                localStorage.setItem('lastUpdate', new Date().toISOString());

                saveData();
                displayFlashcards();
                displayWordList();
                updateStats();
                updateWordsCounter();
                showNotification(`تم إضافة ${newCards.length} تعبير جديد بنجاح`);
            } else {
                showNotification('لم يتم العثور على بيانات صالحة في الملف', 'error');
            }
        }

        function parseExcelData(data) {
            const newCards = [];

            // تخطي السطر الأول إذا كان يحتوي على عناوين
            const startIndex = (data[0][0] === 'word' || data[0][0] === 'كلمة' || data[0][0] === 'تعبير') ? 1 : 0;

            for (let i = startIndex; i < data.length; i++) {
                const row = data[i];
                if (row && row.length >= 2) {
                    const word = String(row[0]).trim();
                    const translation = String(row[1]).trim();

                    if (word && translation) {
                        newCards.push({
                            id: Date.now() + i,
                            word,
                            translation,
                            mastered: false,
                            lastReviewed: null,
                            storageLevel: 'weak',
                            reviewCount: 0,
                            correctAnswers: 0
                        });
                    }
                }
            }

            if (newCards.length > 0) {
                // دمج الكلمات المرفوعة مع الكلمات الحالية
                const mergedWords = mergeWordsWithDefaults([...flashcards, ...newCards]);
                flashcards = mergedWords;
                filteredCards = [...flashcards];

                // تحديث تاريخ آخر تحديث
                localStorage.setItem('lastUpdate', new Date().toISOString());

                saveData();
                displayFlashcards();
                displayWordList();
                updateStats();
                updateWordsCounter();
                showNotification(`تم إضافة ${newCards.length} تعبير جديد بنجاح`);
            } else {
                showNotification('لم يتم العثور على بيانات صالحة في الملف', 'error');
            }
        }

        // ===== وظائف عرض الفلاش كاردز =====
        function displayFlashcards() {
            const container = document.getElementById('flashcards-container');
            container.innerHTML = '';

            if (filteredCards.length === 0) {
                container.innerHTML = '<p class="no-cards">لا توجد تعبيرات للعرض. قم بإضافة تعبيرات أو رفع ملف CSV أو Excel.</p>';
                return;
            }

            const fragment = document.createDocumentFragment();

            filteredCards.forEach(card => {
                const flashcardElement = createFlashcardElement(card);
                fragment.appendChild(flashcardElement);
            });

            container.appendChild(fragment);
        }

        function createFlashcardElement(card) {
            const flashcardElement = document.createElement('div');
            flashcardElement.className = 'flashcard';
            flashcardElement.dataset.id = card.id;

            // تحديد الألوان بناءً على مستوى الحفظ
            let frontColor, backColor, frontIcon, backIcon;

            switch (card.storageLevel) {
                case 'strong':
                    frontColor = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                    backColor = 'linear-gradient(135deg, #229954, #27ae60)';
                    frontIcon = 'fas fa-trophy';
                    backIcon = 'fas fa-crown';
                    break;
                case 'medium':
                    frontColor = 'linear-gradient(135deg, #f39c12, #f1c40f)';
                    backColor = 'linear-gradient(135deg, #e67e22, #f39c12)';
                    frontIcon = 'fas fa-medal';
                    backIcon = 'fas fa-award';
                    break;
                default: // weak
                    frontColor = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                    backColor = 'linear-gradient(135deg, #c0392b, #a93226)';
                    frontIcon = 'fas fa-seedling';
                    backIcon = 'fas fa-sprout';
            }

            flashcardElement.innerHTML = `
                <div class="flashcard-inner">
                    <div class="flashcard-front" style="background: ${frontColor};">
                        <h3>${card.word}</h3>
                        <div class="storage-indicator">
                            <i class="${frontIcon}"></i>
                        </div>
                    </div>
                    <div class="flashcard-back" style="background: ${backColor};">
                        <h3>${card.translation}</h3>
                        <div class="storage-indicator">
                            <i class="${backIcon}"></i>
                        </div>
                    </div>
                </div>
                
                <!-- أزرار تغيير مستوى الحفظ -->
                <div class="storage-controls">
                    <button class="storage-btn weak" onclick="changeStorageLevel(${card.id}, 'weak')" title="مستوى 1">
                        <i class="fas fa-seedling"></i>
                    </button>
                    <button class="storage-btn medium" onclick="changeStorageLevel(${card.id}, 'medium')" title="مستوى 2">
                        <i class="fas fa-medal"></i>
                    </button>
                    <button class="storage-btn strong" onclick="changeStorageLevel(${card.id}, 'strong')" title="مستوى 3">
                        <i class="fas fa-trophy"></i>
                    </button>
                </div>
            `;

            // استخدام أحداث اللمس للموبايل وأحداث النقر للكمبيوتر
            flashcardElement.addEventListener('click', (e) => {
                // تجاهل النقر إذا كان على أزرار التحكم
                if (e.target.closest('.storage-controls')) return;

                e.preventDefault();
                flipCard(flashcardElement);
                markAsReviewed(card);
            });

            // إضافة دعم لللمس على الموبايل
            flashcardElement.addEventListener('touchstart', (e) => {
                // منع السلوك الافتراضي للتمرير
                e.preventDefault();
            });

            flashcardElement.addEventListener('touchend', (e) => {
                // تجاهل اللمس إذا كان على أزرار التحكم
                if (e.target.closest('.storage-controls')) return;

                e.preventDefault();
                flipCard(flashcardElement);
                markAsReviewed(card);
            });

            return flashcardElement;
        }

        function changeStorageLevel(cardId, level) {
            const card = flashcards.find(c => c.id === cardId);
            if (!card) return;

            const oldLevel = card.storageLevel;
            card.storageLevel = level;

            // تحديث حالة الإتقان إذا كان المستوى ممتاز
            if (level === 'strong') {
                card.mastered = true;
            } else if (oldLevel === 'strong') {
                card.mastered = false;
            }

            saveData();
            displayFlashcards();
            updateStats();

            const levelText = getStorageLevelText(level);
            showNotification(`تم تغيير مستوى حفظ "${card.word}" إلى ${levelText}`);
        }

        function flipCard(cardElement) {
            cardElement.classList.toggle('flipped');

            // تشغيل صوت القلب
            if (getSetting('soundEnabled') !== false) {
                playSound('flip');
            }
        }

        function markAsReviewed(card) {
            card.lastReviewed = new Date().toISOString();
            card.reviewCount = (card.reviewCount || 0) + 1;

            // زيادة التقدم اليومي
            studyStats.dailyProgress++;

            saveData();
            updateStats();
        }

        // ===== وظائف الفلترة والبحث =====
        function filterCards() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const storageLevel = document.getElementById('storageLevelFilter').value;

            filteredCards = flashcards.filter(card => {
                const matchesSearch = card.word.toLowerCase().includes(searchTerm) ||
                    card.translation.toLowerCase().includes(searchTerm);
                const matchesStorageLevel = storageLevel === 'all' || card.storageLevel === storageLevel;

                return matchesSearch && matchesStorageLevel;
            });

            displayFlashcards();
            updateWordsCounter();
        }

        function shuffleCards() {
            filteredCards.sort(() => Math.random() - 0.5);
            displayFlashcards();
            showNotification('تم خلط الكروت');
        }

        function resetCards() {
            filteredCards = [...flashcards];
            document.getElementById('searchInput').value = '';
            document.getElementById('storageLevelFilter').value = 'all';
            displayFlashcards();
            updateWordsCounter();
            showNotification('تم تحديث العرض');
        }

        // ===== وظائف الاختبار =====
        function startQuiz() {
            if (flashcards.length < 4) {
                showNotification('يجب أن يكون هناك على الأقل 4 تعبيرات لبدء الاختبار', 'error');
                return;
            }

            // الحصول على إعدادات الاختبار
            const wordCount = document.getElementById('quizWordCount').value;
            const timerDuration = parseInt(document.getElementById('quizTimer').value);

            currentQuiz = {
                questions: generateQuizQuestions(wordCount),
                currentQuestion: 0,
                score: 0,
                answers: [],
                timerDuration: timerDuration
            };

            // إخفاء إعدادات الاختبار وعرض واجهة الاختبار
            document.getElementById('quizSetup').classList.add('hidden');
            document.getElementById('quizInterface').classList.remove('hidden');

            showQuestion();
        }

        function generateQuizQuestions(wordCount) {
            const questions = [];
            const shuffled = [...flashcards].sort(() => Math.random() - 0.5);
            let questionCount;

            if (wordCount === 'all') {
                questionCount = Math.min(20, shuffled.length);
            } else {
                questionCount = Math.min(parseInt(wordCount), shuffled.length);
            }

            for (let i = 0; i < questionCount; i++) {
                const card = shuffled[i];
                const options = [card.translation];

                // إضافة خيارات خاطئة
                while (options.length < 4) {
                    const randomCard = flashcards[Math.floor(Math.random() * flashcards.length)];
                    if (!options.includes(randomCard.translation)) {
                        options.push(randomCard.translation);
                    }
                }

                // خلط الخيارات
                options.sort(() => Math.random() - 0.5);

                questions.push({
                    word: card.word,
                    correctAnswer: card.translation,
                    options: options
                });
            }

            return questions;
        }

        function showQuestion() {
            if (!currentQuiz || currentQuiz.currentQuestion >= currentQuiz.questions.length) {
                return;
            }

            // إعادة تعيين حالة الاختيار
            answerSelected = false;

            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            const questionElement = document.getElementById('quizQuestion');
            const optionsElement = document.getElementById('quizOptions');

            questionElement.textContent = `ما هي ترجمة: "${question.word}"؟`;

            optionsElement.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => selectAnswer(option, optionElement));
                optionsElement.appendChild(optionElement);
            });

            // تحديث عداد الأسئلة
            document.getElementById('currentQuestion').textContent =
                `${currentQuiz.currentQuestion + 1}/${currentQuiz.questions.length}`;

            // بدء المؤقت إذا كان مفعلاً
            if (currentQuiz.timerDuration > 0) {
                startQuestionTimer();
            } else {
                document.getElementById('timeRemaining').textContent = '∞';
                document.getElementById('quizTimerDisplay').innerHTML = '';
            }
        }

        function startQuestionTimer() {
            // إيقاف أي مؤقت سابق
            if (quizTimer) {
                clearInterval(quizTimer);
            }

            timeRemaining = currentQuiz.timerDuration;
            updateTimerDisplay();

            quizTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    clearInterval(quizTimer);
                    // انتهى الوقت، انتقل للسؤال التالي
                    handleTimeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerDisplay = document.getElementById('timeRemaining');
            const timerBar = document.getElementById('quizTimerDisplay');

            if (timeRemaining > 0) {
                timerDisplay.textContent = timeRemaining;
                timerBar.innerHTML = `
                    <div class="timer-bar" style="width: ${(timeRemaining / currentQuiz.timerDuration) * 100}%; 
                         background: linear-gradient(90deg, ${timeRemaining > 2 ? 'var(--secondary-color)' : 'var(--danger-color)'}, ${timeRemaining > 2 ? '#27ae60' : 'var(--danger-color)'}); 
                         height: 8px; border-radius: 4px; transition: width 1s linear;">
                    </div>
                `;
            } else {
                timerDisplay.textContent = '0';
                timerBar.innerHTML = '';
            }
        }

        function handleTimeUp() {
            // تعطيل جميع الخيارات
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.style.opacity = '0.6';
            });

            // تمييز الإجابة الصحيحة
            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            document.querySelectorAll('.quiz-option').forEach(opt => {
                if (opt.textContent === question.correctAnswer) {
                    opt.classList.add('correct');
                }
            });

            // إضافة إجابة خاطئة
            currentQuiz.answers.push({
                question: question.word,
                userAnswer: 'لم يجب',
                correctAnswer: question.correctAnswer,
                isCorrect: false
            });

            // الانتقال للسؤال التالي بعد ثانيتين
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }

        function selectAnswer(answer, element) {
            // منع الاختيار المتعدد
            if (answerSelected) {
                return;
            }

            // تعيين أن الإجابة تم اختيارها
            answerSelected = true;

            // إيقاف المؤقت
            if (quizTimer) {
                clearInterval(quizTimer);
            }

            // تعطيل جميع الخيارات
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });

            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            const isCorrect = answer === question.correctAnswer;

            if (isCorrect) {
                element.classList.add('correct');
                currentQuiz.score++;

                // تحديث إحصائيات الكلمة
                const card = flashcards.find(c => c.word === question.word);
                if (card) {
                    card.correctAnswers = (card.correctAnswers || 0) + 1;

                    // ترقية مستوى الحفظ إذا كانت الإجابة صحيحة
                    if (card.correctAnswers >= 3 && card.storageLevel === 'weak') {
                        card.storageLevel = 'medium';
                        showNotification(`تم ترقية "${card.word}" إلى مستوى 2`, 'success');
                    } else if (card.correctAnswers >= 5 && card.storageLevel === 'medium') {
                        card.storageLevel = 'strong';
                        card.mastered = true;
                        showNotification(`تم ترقية "${card.word}" إلى مستوى 3`, 'success');
                    }
                }

                // تشغيل صوت الإجابة الصحيحة
                if (getSetting('soundEnabled') !== false) {
                    playSound('correct');
                }
            } else {
                element.classList.add('incorrect');
                // تمييز الإجابة الصحيحة
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.textContent === question.correctAnswer) {
                        opt.classList.add('correct');
                    }
                });
            }

            currentQuiz.answers.push({
                question: question.word,
                userAnswer: answer,
                correctAnswer: question.correctAnswer,
                isCorrect: isCorrect
            });

            // تحديث النتيجة
            document.getElementById('quizScore').textContent = currentQuiz.score;

            // الانتقال التلقائي للسؤال التالي بعد ثانية واحدة
            setTimeout(() => {
                nextQuestion();
            }, 1000);
        }

        function nextQuestion() {
            currentQuiz.currentQuestion++;

            if (currentQuiz.currentQuestion < currentQuiz.questions.length) {
                // إعادة تفعيل الخيارات
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.style.pointerEvents = 'auto';
                    opt.classList.remove('correct', 'incorrect');
                    opt.style.opacity = '1';
                });

                showQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            if (!currentQuiz) return;

            // إيقاف المؤقت
            if (quizTimer) {
                clearInterval(quizTimer);
            }

            const percentage = Math.round((currentQuiz.score / currentQuiz.questions.length) * 100);

            // عرض النتائج في النافذة المنبثقة
            document.getElementById('totalQuestions').textContent = currentQuiz.questions.length;
            document.getElementById('correctAnswers').textContent = currentQuiz.score;
            document.getElementById('percentageScore').textContent = percentage + '%';

            document.getElementById('resultModal').style.display = 'block';

            // إعادة تعيين واجهة الاختبار
            document.getElementById('quizSetup').classList.remove('hidden');
            document.getElementById('quizInterface').classList.add('hidden');

            // مسح بيانات الاختبار
            currentQuiz = null;

            // تحديث الإحصائيات
            updateStats();
        }

        function cancelQuiz() {
            if (!currentQuiz) return;

            // إيقاف المؤقت
            if (quizTimer) {
                clearInterval(quizTimer);
            }

            // إعادة تعيين واجهة الاختبار
            document.getElementById('quizSetup').classList.remove('hidden');
            document.getElementById('quizInterface').classList.add('hidden');

            // مسح بيانات الاختبار
            currentQuiz = null;

            // إعادة تعيين عرض النتيجة
            document.getElementById('quizScore').textContent = '0';
            document.getElementById('currentQuestion').textContent = '1/10';
            document.getElementById('timeRemaining').textContent = '5';
            document.getElementById('quizTimerDisplay').innerHTML = '';

            showNotification('تم إلغاء الاختبار');
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // ===== وظائف الإحصائيات =====
        function updateStats() {
            studyStats.totalWords = flashcards.length;
            studyStats.masteredWords = flashcards.filter(card => card.mastered).length;

            updateStatsDisplay();
            saveData();
        }

        function updateStatsDisplay() {
            document.getElementById('totalWords').textContent = studyStats.totalWords;

            const strongWords = flashcards.filter(card => card.storageLevel === 'strong').length;
            const mediumWords = flashcards.filter(card => card.storageLevel === 'medium').length;
            const weakWords = flashcards.filter(card => card.storageLevel === 'weak').length;

            document.getElementById('strongWords').textContent = strongWords;
            document.getElementById('mediumWords').textContent = mediumWords;
            document.getElementById('weakWords').textContent = weakWords;

            document.getElementById('studyTime').textContent = formatTime(studyStats.studyTime);

            const masteryRate = studyStats.totalWords > 0 ?
                Math.round((strongWords / studyStats.totalWords) * 100) : 0;
            document.getElementById('masteryRate').textContent = masteryRate + '%';

            // تحديث شريط التقدم اليومي
            const dailyGoal = parseInt(document.getElementById('dailyWordsGoal').value) || 20;
            const progressPercent = Math.min((studyStats.dailyProgress / dailyGoal) * 100, 100);
            document.getElementById('dailyProgress').style.width = progressPercent + '%';
        }

        function updateStudyTime() {
            if (studyStartTime) {
                const elapsedMinutes = Math.floor((Date.now() - studyStartTime) / 60000);
                studyStats.studyTime += elapsedMinutes;
                studyStartTime = Date.now();
                updateStatsDisplay();
            }
        }

        function formatTime(minutes) {
            if (minutes < 60) {
                return `${minutes} دقيقة`;
            } else {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hours} ساعة ${mins} دقيقة`;
            }
        }

        function updateChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');

            // حساب الكلمات حسب مستوى الحفظ
            const strongWords = flashcards.filter(card => card.storageLevel === 'strong').length;
            const mediumWords = flashcards.filter(card => card.storageLevel === 'medium').length;
            const weakWords = flashcards.filter(card => card.storageLevel === 'weak').length;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['مستوى 3', 'مستوى 2', 'مستوى 1'],
                    datasets: [{
                        label: 'عدد التعبيرات',
                        data: [strongWords, mediumWords, weakWords],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(231, 76, 60, 0.8)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'توزيع التعبيرات حسب مستوى الحفظ',
                            font: {
                                family: 'Cairo',
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    family: 'Cairo',
                                    size: 14
                                },
                                stepSize: 1
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Cairo',
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        }

        // ===== وظائف الإعدادات =====
        function toggleDarkMode() {
            const isEnabled = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-mode', isEnabled);

            const settings = getSettings();
            settings.darkMode = isEnabled;
            saveSettings(settings);
        }

        function toggleSound() {
            const isEnabled = document.getElementById('soundToggle').checked;

            const settings = getSettings();
            settings.soundEnabled = isEnabled;
            saveSettings(settings);
        }

        function updateDailyGoal() {
            const goal = parseInt(document.getElementById('dailyWordsGoal').value) || 20;
            document.getElementById('dailyGoal').textContent = goal;

            const settings = getSettings();
            settings.dailyGoal = goal;
            saveSettings(settings);

            updateStatsDisplay();
        }

        function exportData() {
            // إنشاء ورقة عمل للكلمات
            const wordsData = flashcards.map(card => ({
                'التعبير الإسباني': card.word,
                'الترجمة العربية': card.translation,
                'مستوى الحفظ': getStorageLevelText(card.storageLevel),
                'متقنة': card.mastered ? 'نعم' : 'لا',
                'عدد المراجعات': card.reviewCount || 0,
                'الإجابات الصحيحة': card.correctAnswers || 0,
                'آخر مراجعة': card.lastReviewed ? new Date(card.lastReviewed).toLocaleDateString('ar-SA') : 'لم تتم المراجعة'
            }));

            // إنشاء ورقة عمل للإحصائيات
            const statsData = [
                { 'المؤشر': 'إجمالي التعبيرات', 'القيمة': studyStats.totalWords },
                { 'المؤشر': 'التعبيرات المتقنة', 'القيمة': studyStats.masteredWords },
                { 'المؤشر': 'وقت الدراسة (دقيقة)', 'القيمة': studyStats.studyTime },
                { 'المؤشر': 'نسبة الإتقان (%)', 'القيمة': studyStats.totalWords > 0 ? Math.round((studyStats.masteredWords / studyStats.totalWords) * 100) : 0 },
                { 'المؤشر': 'التقدم اليومي', 'القيمة': studyStats.dailyProgress },
                { 'المؤشر': 'تاريخ التصدير', 'القيمة': new Date().toLocaleDateString('ar-SA') + ' ' + new Date().toLocaleTimeString('ar-SA') }
            ];

            // إنشاء مصنف Excel
            const wb = XLSX.utils.book_new();

            // إضافة ورقة الكلمات
            const wordsWs = XLSX.utils.json_to_sheet(wordsData);
            XLSX.utils.book_append_sheet(wb, wordsWs, "التعبيرات");

            // إضافة ورقة الإحصائيات
            const statsWs = XLSX.utils.json_to_sheet(statsData);
            XLSX.utils.book_append_sheet(wb, statsWs, "الإحصائيات");

            // تعديل عرض الأعمدة لتناسب المحتوى
            const wordsColWidths = [
                { wch: 20 }, // التعبير الإسباني
                { wch: 20 }, // الترجمة العربية
                { wch: 15 }, // مستوى الحفظ
                { wch: 10 }, // متقنة
                { wch: 15 }, // عدد المراجعات
                { wch: 15 }, // الإجابات الصحيحة
                { wch: 20 }  // آخر مراجعة
            ];
            wordsWs['!cols'] = wordsColWidths;

            const statsColWidths = [
                { wch: 20 }, // المؤشر
                { wch: 15 }  // القيمة
            ];
            statsWs['!cols'] = statsColWidths;

            // تصدير الملف
            const fileName = `flashcards_backup_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);

            showNotification('تم تصدير البيانات إلى ملف Excel بنجاح');
        }

        function clearData() {
            if (confirm('هل أنت متأكد من أنك تريد مسح جميع البيانات؟ لا يمكن التراجع عن هذا الإجراء.')) {
                localStorage.clear();
                flashcards = [];
                filteredCards = [];
                studyStats = {
                    totalWords: 0,
                    masteredWords: 0,
                    studyTime: 0,
                    dailyProgress: 0
                };

                displayFlashcards();
                displayWordList();
                updateStatsDisplay();
                updateWordsCounter();
                showNotification('تم مسح جميع البيانات');
            }
        }

        // ===== وظائف الصوت =====
        function playSound(type) {
            // في تطبيق حقيقي، يمكنك استخدام ملفات صوتية حقيقية
            // هنا نستخدم واجهة برمجة تطبيقات الويب الصوتية لتوليد أصوات بسيطة
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'flip') {
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.value = 1000;
                gainNode.gain.value = 0.2;
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            }
        }

        // ===== وظائف المساعدة =====
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            // إزالة الإشعار بعد 3 ثواني
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function getSettings() {
            return JSON.parse(localStorage.getItem('flashcardSettings')) || {};
        }

        function saveSettings(settings) {
            localStorage.setItem('flashcardSettings', JSON.stringify(settings));
        }

        function getSetting(key) {
            const settings = getSettings();
            return settings[key];
        }

        function saveData() {
            try {
                localStorage.setItem('flashcards', JSON.stringify(flashcards));
                localStorage.setItem('studyStats', JSON.stringify(studyStats));
                localStorage.setItem('flashcardSettings', JSON.stringify(getSettings()));
            } catch (e) {
                console.error('Error saving data:', e);
                showNotification('حدث خطأ أثناء حفظ البيانات', 'error');
            }
        }

        function validateCard(card) {
            return card.word && card.translation &&
                typeof card.word === 'string' &&
                typeof card.translation === 'string' &&
                card.word.trim() !== '' &&
                card.translation.trim() !== '';
        }
    </script>
</body>

</html>